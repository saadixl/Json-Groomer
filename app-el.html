<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="./json-prettifier.html">

<dom-module id="app-el">
  <template>
    <style>
      :host {
        display: block;
      }
      #inp {
        position: fixed;
        width: 50%;
        height: 100%;
        left: 0;
        top: 0;
        background: #333;
        padding: 1%;
      }

      #inp textarea {
        width: 94%;
        height: 90%;
        background: transparent;
        outline: none;
        color: #f5f5f5;
        font-family: monospace;
        font-size: 15px;
      }

      #content {
        position: fixed;
        width: 50%;
        height: 100%;
        left: 50%;
        top: 0;
        background: #f5f5f5;
      }
    </style>
    <p>JSON Prettifier</p>
    <div id="inp">
      <textarea id="inpArea">{
"name": "Masudul Haque",
"email": "saadixl@mail.com",
"address": {
  "house": "XX",
  "road": "Y",
  "area": "Central Homeland",
  "city": "Dhaka",
  "country": "Bangladesh"
  },
  "phone": {
    "mobile": {
      "career": "SomeTel",
      "number" : "0123456789"
    },
    "office": "0987654321"
  }
}</textarea>
      <br />
      <button on-tap="prettify">Prettify</button>
    </div>
    <div id="content"></div>
  </template>
  <script>
    Polymer({
      is: 'app-el',
      traverse: function(jsonObj) {
        var jsonPrettifierParent = document.createElement('json-prettifier');
        jsonPrettifierParent.itemType = "object";
        if(typeof jsonObj === "object") {
          for(var key in jsonObj) {
            if(jsonObj.hasOwnProperty(key)) {
              var jsonPrettifierChild = document.createElement('json-prettifier');
              jsonPrettifierChild.label = key;
              var content = this.traverse(jsonObj[key]);
              if(typeof content === "object") {
                Polymer.dom(jsonPrettifierChild).appendChild(content);
              } else {
                var textNode = document.createTextNode(content);
                Polymer.dom(jsonPrettifierChild).appendChild(textNode);
              }
              Polymer.dom(jsonPrettifierParent).appendChild(jsonPrettifierChild);
            }
          }
        }
        else {
          return jsonObj;
        }
        return jsonPrettifierParent;
      },
      prettify: function() {
        var textAreaValue = this.$.inpArea.value;
        var jsonObject = JSON.parse(textAreaValue);
        var jsonPrettified = this.traverse(jsonObject);
        var finalElement = document.createElement('json-prettifier');
        Polymer.dom(finalElement).appendChild(jsonPrettified);
        finalElement.label = "Object";
        Polymer.dom(this.$.content).innerHTML = '';
        Polymer.dom(this.$.content).appendChild(finalElement);
      },
    });
  </script>
</dom-module>
